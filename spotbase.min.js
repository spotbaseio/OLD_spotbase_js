class Spotbase{constructor(e){this.apiId=e,this.limit=100,this.start=0,this.deepLimit=1,this.showDraftItems=!1,this.showArchivedItems=!1,this.enableLoader=!1,this.enableNoResult=!1,this.enableUrlParams=!1,this.enableSort=!1,this.sort={target:"Created On",collection:"__root",direction:"az",group:"date",toggleActiveClass:"filter-toggle-active",type:"toggle"},this.enablePagination=!1,this.pagination={pageItems:100,page:1,maxButtons:5,textStart:"Start",textPrev:"Prev",textNext:"Next",textEnd:"End",activeClass:"pagination-active",disabledClass:"pagination-disabled",loadMore:!1,textLoad:"Load More",infiniteScroll:!1,scrollPercentage:80},this.enableFilter=!1,this.filter={filters:[],rootFilters:[],toggleActiveClass:"filter-toggle-active"},this.enableSearch=!1,this.search={smart:!1,accuracy:70,delay:500,timer:null},this.enableRecap=!1,this.savedParams=[],this.private={scrollLoading:!1,lastPage:!1}}load(e){let t=[{type:"load",group:"limit",value:this.limit},{type:"load",group:"start",value:this.start},{type:"load",group:"showDraftItems",value:this.showDraftItems},{type:"load",group:"showArchivedItems",value:this.showArchivedItems},{type:"load",group:"deepLimit",value:this.deepLimit}];if(!0===e.enableUrlParams&&(this.enableUrlParams=!0),!0===e.enableFilter&&(this.enableFilter=!0),!0===e.enableSearch){this.enableSearch=!0;const e=document.querySelector('[sb-search="input"]'),s=e.getAttribute("sb-search-field"),i=e.getAttribute("sb-search-coll");let a=s.split(","),r=i.split(",");t.push({type:"search",collection:r,target:a,value:"",smart:this.search.smart,accuracy:this.search.accuracy})}!0===e.enableSort&&(this.enableSort=!0,t.push({type:"sort",collection:this.sort.collection,target:this.sort.target,group:this.sort.group,value:this.sort.direction})),!0===e.enablePagination&&(this.enablePagination=!0,t.push({type:"pagination",group:"pageItems",value:this.pagination.pageItems},{type:"pagination",group:"page",value:this.pagination.page})),!0===e.enableRecap&&(this.enableRecap=!0);let s=["limit","start","showDraftItems","showArchivedItems","deepLimit","sort","pagination","filter","search"];["limit","start","showDraftItems","showArchivedItems","deepLimit","hideClass","enableLoader","enableNoResult","sort","pagination","filter","search"].filter((i=>{if(e.hasOwnProperty(i))if(s.includes(i)){if("sort"==i){if(!0===this.enableSort){let s=Object.keys(e[i]);const a=t.find((e=>e.type===i));s.map((t=>{"direction"===t?a.value=e[i][t]:("target"===t||"collection"===t||"group"===t)&&(a[t]=e[i][t]),this[i][t]=e[i][t]}))}}else if("pagination"==i){if(!0===this.enablePagination){Object.keys(e[i]).forEach((s=>{if("pageItems"==s||"page"===s){t.find((e=>e.type==i&&e.group==s)).value=e[i][s],this[i][s]=e[i][s]}else this[i][s]=e[i][s]}))}}else if("filter"==i){Object.keys(e[i]).forEach((s=>{"filters"===s?(e[i][s].forEach((e=>{t.push({type:i,group:e.group,target:e.target,collection:e.collection,value:e.value})})),this[i][s]=e[i][s]):"rootFilters"===s?(e[i][s].forEach((e=>{t.push({type:s,target:e.target,collection:e.collection,value:e.value})})),this[i][s]=e[i][s]):this[i][s]=e[i][s]}))}else if("search"==i){if(!0===this.enableSearch){Object.keys(e[i]).forEach((s=>{if("smart"==s||"accuracy"===s){t.find((e=>e.type==i))[s]=e[i][s],this[i][s]=e[i][s]}else this[i][s]=e[i][s]}))}}else if("limit"==i||"start"==i||"showDraftItems"==i||"showArchivedItems"==i||"deepLimit"==i){t.find((e=>e.group===i)).value=e[i],this[i]=e[i]}}else this[i]=e[i]})),this.prepareUI(),this.addListeners(),this.startQueryPromises(t,!0)}prepareUI(){const e=document.createElement("div");if(e.style.display="none",document.body.appendChild(e),this.enableLoader){document.querySelector('[sb-load="loader"]').style.display="none"}if(this.enableNoResult){document.querySelector('[sb-load="no-result"]').style.display="none"}const t=document.querySelector('[sb-load="item"]');if(e.appendChild(t),t.style.display="none",this.enablePagination){if(!this.pagination.loadMore&&!this.pagination.infiniteScroll){["start","prev","next","end"].forEach((t=>{const s=document.querySelector(`[sb-pag-btn='${t}']`),i=s.querySelector('[sb-pag-btn="text"]'),a="text"+t.charAt(0).toUpperCase()+t.slice(1);i.textContent=this.pagination[a],e.appendChild(s),s.style.display="none"}));const t=document.querySelector('[sb-pag-btn="num"]');e.appendChild(t),t.style.display="none",document.querySelector('[sb-pag="load-more"]')&&(document.querySelector('[sb-pag="load-more"]').style.display="none")}if(this.pagination.loadMore&&!this.pagination.infiniteScroll){const t=document.querySelector("[sb-pag-btn='load-more']");t.querySelector('[sb-pag-btn="text"]').textContent=this.pagination.textLoad,e.appendChild(t),t.style.display="none",document.querySelector('[sb-pag="classic"]')&&(document.querySelector('[sb-pag="classic"]').style.display="none")}this.pagination.infiniteScroll&&(document.querySelector('[sb-pag="classic"]')&&(document.querySelector('[sb-pag="classic"]').style.display="none"),document.querySelector('[sb-pag="load-more"]')&&(document.querySelector('[sb-pag="load-more"]').style.display="none"))}else document.querySelector('[sb-pag="classic"]')&&(document.querySelector('[sb-pag="classic"]').style.display="none"),document.querySelector('[sb-pag="load-more"]')&&(document.querySelector('[sb-pag="load-more"]').style.display="none");this.enableFilter&&(this.enableSort&&this.updateSortUI(this.sort.collection,this.sort.target,this.sort.group,this.sort.direction),this.filter.filters.length&&this.filter.filters.forEach((e=>{const t=e.group;e.value.length&&e.value.forEach((e=>{this.updateFiltersUI("toggle",t,e)}))}))),this.enableSearch}startQueryPromises(e,t){this.prepareToShowItems(!1);const s=e=>new Promise(((t,s)=>{t(this.generateParamsForRequest(e))})),i=e=>new Promise(((t,s)=>{t(this.sendRequestAndGetResult(e))})),a=e=>new Promise(((t,s)=>{t(this.prepareForNewItems(e))}));(e=>new Promise(((s,i)=>{this.enableUrlParams&&t?s(this.getUrlParams(e)):s(e)})))(e).then((e=>s(e))).then((e=>i(e))).then((e=>a(e))).then((e=>{})).catch((e=>{}))}preStartQueryPromises(){document.querySelector('[sb-load="item-list"]').innerHTML="",this.enablePagination?(this.pagination.infiniteScroll&&(this.private.lastPage=!1),this.updatePage(1)):this.startQueryPromises(this.savedParams,!1)}getUrlParams(e){const t=window.location.search,s=new URLSearchParams(t);for(let e of s.keys())if("sort"!==e&&"search"!==e&&"page"!==e){document.querySelectorAll('[sb-filter-type="toggle"]').forEach((e=>{e.classList.remove(this.filter.toggleActiveClass)}))}return s.forEach(((t,s)=>{if("search"==s){if(this.enableSearch){if(e.some((e=>e.type===s))){e.find((e=>e.type===s)).value=t}else{const s={type:"search",value:t,target:[],collection:[]};e.push(s)}this[s].value=t,this.updateSearchUI(t)}}else if("sort"==s){if(this.enableSort){let i,a,r=t.split(","),o=null;if("toggle"===this.sort.type)i=document.querySelector(`[sb-sort-group=${JSON.stringify(r[0])}  ][sb-sort-dir=${JSON.stringify(r[1])}]`),a=i.getAttribute("sb-sort-coll"),o=i.getAttribute("sb-sort-field");else if("select"===this.sort.type){i=document.querySelector('[sb-sort-type="select"]');for(const e of i){const t=e.value.split(",");if(r[0]==t[3]&&r[1]==t[2]){a=t[0],o=t[1];break}}}if(e.some((e=>e.type===s&&"sort"===e.type))){const t=e.find((e=>e.type===s));t.collection=a,t.target=o,t.group=r[0],t.value=r[1]}else{const t={type:"sort",collection:a,target:o,group:r[0],value:r[1]};e.push(t)}this[s].collection=a,this[s].target=o,this[s].group=r[0],this[s].direction=r[1],this.updateSortUI(this.sort.collection,this.sort.target,r[0],r[1])}}else if("page"==s){if(this.enablePagination&&!this.pagination.loadMore&&!this.pagination.infiniteScroll){if(e.some((e=>"pagination"===e.type&&e.group===s))){e.find((e=>e.group===s&&"pagination"==e.type)).value=parseInt(t)}else{const i={type:"pagination",group:s,value:parseInt(t)};e.push(i)}this.pagination.page=parseInt(t)}}else{t.split(",").forEach(((t,i)=>{const a=document.querySelector(`[sb-filter-group=${JSON.stringify(s)}][sb-filter-value=${JSON.stringify(t)}]`);if(a){if(e.some((e=>e.group===s&&"filter"===e.type))){let a=e.find((e=>e.group===s&&"filter"===e.type));0==i&&(a.value=[]),a.value.includes(t)||a.value.push(t)}else{const i=a.getAttribute("sb-filter-field"),r=a.getAttribute("sb-filter-coll"),o=i.split(","),l=r.split(","),n={type:"filter",group:s,collection:l,target:o,value:[t]};e.push(n)}this.updateFiltersUI("toggle",s,t)}}))}})),e}generateParamsForRequest(e){encodeURIComponent;let t={};return e.forEach(((e,s,i)=>{let a=e.type;switch(t.hasOwnProperty(e.type)||("filter"!=[e.type]&&"rootFilters"!=[e.type]?t[e.type]={}:a="filter"),a){case"load":t[a][e.group]=e.value;break;case"pagination":t[a][e.group]=e.value;break;case"sort":e.collection.split(">>>").forEach(((e,s)=>{let i=s.toString();t[a].collection?t[a].collection[i]=e:t[a].collection={[i]:e}})),t[a].target=e.target,t[a].value=e.value;break;case"search":{t[a].value=e.value,t[a].where=[];const s=e.target;e.collection.forEach(((e,i)=>{const r=e.split(">>>"),o=s[i].split("|"),l={};r.forEach(((e,t)=>{let s=t.toString();l.collection?l.collection[s]=e:l.collection={[s]:e}})),l.target=o,t[a].where.push(l)})),t[a].smart=e.smart,t[a].accuracy=e.accuracy;break}case"filter":{t[a]||(t[a]=[]);const s={where:[]},i=e.target;e.collection.forEach(((e,t)=>{const a=e.split(">>>"),r=i[t].split("|"),o={};a.forEach(((e,t)=>{let s=t.toString();o.collection?o.collection[s]=e:o.collection={[s]:e}})),o.target=r,s.where.push(o)})),s.value=e.value,t[a].push(s);break}default:}})),this.savedParams=e,t}async sendRequestAndGetResult(e){let t=e;if(t.load.key=this.apiId,t.load.version="0.1.1",!this.enablePagination){const e={page:1,enable:!1};t.pagination=e}this.enableSearch&&""==t.search.value&&delete t.search;const s={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)},i=await fetch("https://api.spotbase.io/load",s),a=await i.json();if(this.enablePagination){const e=this.savedParams.find((e=>"pagination"===e.type&&"page"===e.group));this.pagination.page=e.value}return this.enableUrlParams&&this.updateUrlParams(),a}updateUrlParams(){const e=this.savedParams.filter((function(e,t){return"filter"===e.type||"sort"===e.type||"search"===e.type||"pagination"===e.type&&"page"==e.group})),t=encodeURIComponent;let s="",i=!1;e.forEach(((e,a,r)=>{i=!1,0==a&&(s="?"),"sort"==e.type?(s+=Object.keys(e).filter((e=>"value"!==e)).filter((e=>"target"!==e)).filter((e=>"collection"!==e)).map((s=>t(e[s]))).join("="),s+=`${t(",")}${t(e.value)}`):"search"==e.type?""!==e.value?s+=Object.keys(e).filter((e=>"target"!==e)).filter((e=>"collection"!==e)).filter((e=>"accuracy"!==e)).filter((e=>"smart"!==e)).map((s=>t(e[s]))).join("="):i=!0:"pagination"==e.type?this.pagination.loadMore||this.pagination.infiniteScroll?i=!0:s+=Object.keys(e).filter((e=>"type"!==e)).filter((e=>"target"!==e)).map((s=>t(e[s]))).join("="):"filter"==e.type&&(s+=Object.keys(e).filter((e=>"type"!==e)).filter((e=>"target"!==e)).filter((e=>"collection"!==e)).map((s=>t(e[s]))).join("=")),a!==r.length-1&&0==i&&(s+="&")})),-1!==s.indexOf("&",s.length-1)&&(s=s.substring(0,s.length-1));const a=window.location.href.split("?")[0]+s;window.history.pushState({},"",a)}prepareForNewItems=e=>(this.prepareToShowItems(!0),this.generateItems(e));prepareToShowItems(e){const t=document.querySelector('[sb-load="item-list"]');this.enablePagination&&(this.pagination.loadMore||this.pagination.infiniteScroll)||(t.innerHTML=""),e?(this.enableLoader&&this.showLoader(e),this.enablePagination&&this.pagination.loadMore&!this.pagination.infiniteScroll&&this.showLoadMore(e)):(this.enableLoader&&this.showLoader(e),this.enableNoResult&&this.showNoResult(e),this.enablePagination&&this.pagination.loadMore&!this.pagination.infiniteScroll&&this.showLoadMore(e))}showLoader(e){const t=document.querySelector('[sb-load="loader"]');e?t.style.display="none":t.style.removeProperty("display")}showNoResult(e){const t=document.querySelector('[sb-load="no-result"]');e?t.style.removeProperty("display"):t.style.display="none"}showLoadMore(e){const t=document.querySelector('[sb-pag="load-more"]');e?t.style.removeProperty("display"):t.style.display="none"}generateItems(e){const t=document.querySelector('[sb-load="item-list"]');if(e.items.forEach(((e,s)=>{const i=document.querySelector('[sb-load="item"]').cloneNode(!0);i.removeAttribute("sb-load"),i.hasAttribute("sb-el-field")&&this.structureField(e,i,!1);const a=i.querySelectorAll("[sb-el-field], [sb-load-sub-coll]");let r=[{type:"main",elements:[]}];for(let t=0;t<a.length;++t)if("sub-item-list"===a[t].getAttribute("sb-load")){a[t].hasAttribute("sb-el-field")&&this.structureField(e,a[t],!1);const s={target:a[t].getAttribute("sb-load-sub-coll"),elements:a[t]};r.push(s)}else if(!a[t].closest('[sb-load="sub-item-list"]')){r.find((e=>"main"===e.type)).elements.push(a[t])}r.forEach((t=>{if("main"===t.type)t.elements.forEach((t=>{this.structureField(e,t,!1)}));else{const s=t.elements.querySelector('[sb-load="sub-item"]');s.style.display="none";const i=s.closest('[sb-load="sub-item-list"]');e[t.target]&&e[t.target].items&&e[t.target].items&&e[t.target].items.length&&e[t.target].items.forEach(((a,r,o)=>{let l=s.cloneNode(!0);i.appendChild(l),l.style.removeProperty("display"),l.setAttribute("bolt-target","sub-item");l.querySelectorAll("[sb-el-field]").forEach(((s,i)=>{this.structureField(e[t.target].items[r],s,!0)}))}))}}));const o=i.querySelectorAll("[sb-vis-cond]");for(let t=0;t<o.length;++t){let s=null;o[t].hasAttribute("sb-vis-cond")&&(s=o[t].getAttribute("sb-vis-cond"));let i=null;o[t].hasAttribute("sb-vis-coll")&&(i=o[t].getAttribute("sb-vis-coll"));let a=null;o[t].hasAttribute("sb-vis-field")&&(a=o[t].getAttribute("sb-vis-field"));let r=null;o[t].hasAttribute("sb-vis-ref")&&(r=o[t].getAttribute("sb-vis-ref"));let l=null;switch(i&&("__root"===i?e[a]&&(l=e[a]):e[i]&&e[i].items&&("Single"==e[i].type&&(l=e[i].items[0][a]),"Multi"==e[i].type&&(l="",e[i].items.forEach((e=>{l+=e[a],l+=" "}))))),s){case"equals":l!=r&&(o[t].style.display="none");break;case"does not equal":l==r&&(o[t].style.display="none");break;case"is less than":(Number(l)>Number(r)||Number(l)==Number(r)||!l)&&(o[t].style.display="none");break;case"is greater than":(Number(l)<Number(r)||Number(l)==Number(r)||!l)&&(o[t].style.display="none");break;case"is between":{const e=r.split("-");2==e.length&&(Number(l)>=Number(e[0])&&Number(l)<=Number(e[1])||(o[t].style.display="none"));break}case"is not between":{const e=r.split("-");2==e.length&&(Number(l)<Number(e[0])||Number(l)>Number(e[1])||(o[t].style.display="none"));break}case"is set":l||(o[t].style.display="none");break;case"is not set":l&&(o[t].style.display="none");break;case"is on":l||(o[t].style.display="none");break;case"is off":l&&(o[t].style.display="none");break;case"contains":(l&&!l.toString().toLowerCase().includes(r.toString().toLowerCase())||!l)&&(o[t].style.display="none");break;case"does not contain":(l&&l.toString().toLowerCase().includes(r.toString().toLowerCase())||!l)&&(o[t].style.display="none");break;case"is before or equal to":{const e=new Date(l),s=new Date(r);(e>s||e==s||!l)&&(o[t].style.display="none");break}case"is after or equal to":{const e=new Date(l),s=new Date(r);(e<s||e==s||!l)&&(o[t].style.display="none");break}default:}}i.style.removeProperty("display"),t.appendChild(i)})),this.enablePagination&&(this.pagination.loadMore||this.pagination.infiniteScroll||this.generatePagination(e.pagination),this.pagination.loadMore&&!this.pagination.infiniteScroll&&this.generateLoadMore(e.pagination),this.pagination.infiniteScroll&&(this.private.scrollLoading=!1,e.pagination.page==e.pagination.pages&&(this.private.lastPage=!0))),this.enableNoResult&&(e.pagination.pages>0?this.showNoResult(!1):this.showNoResult(!0)),this.enableRecap){const t=document.querySelector('[sb-recap="from"]'),s=document.querySelector('[sb-recap="to"]'),i=document.querySelector('[sb-recap="total"]');t&&(t.innerText=e.recap.from,this.enablePagination&&(this.pagination.loadMore||this.pagination.infiniteScroll)&&(t.innerText="1")),s&&(s.innerText=e.recap.to),i&&(i.innerText=e.recap.total)}return"item generated"}isNumeric(e){return!isNaN(e)}structureField(e,t,s,i){const a=t,r=a.getAttribute("sb-el-field").split(","),o=a.getAttribute("sb-el-type").split(","),l=!1;let n=1;for(let e=0;e<r.length;e++)if(""===r[e]){l=!0;break}if(!l)for(let e=0;e<o.length;e++)if(""===o[e]){l=!0;break}r.length>1&&o.length>1&&r.length==o.length&&0==l&&(n=o.length);for(let t=0;t<n;t++){let s=e;const i=r[t];if(s[i])switch(o[t]){case"text":a.textContent=s[i];break;case"href":a.href=s[i];break;case"alt":a.alt=s[i];break;case"title":a.title=s[i];break;case"text-color":a.style.color=s[i];break;case"bg-color":a.style.backgroundColor=s[i];break;case"border-color":a.style.borderColor=s[i];break;case"image":a.removeAttribute("src"),a.removeAttribute("srcset"),a.src=s[i].url;break;case"bg-image":a.style.backgroundImage="url('"+s[i].url+"')";break;case"rich-text":a.innerHTML="",a.innerHTML=s[i];break;default:}}}filterItems(e,t,s,i,a,r,o){const l=a.split(","),n=i.split(",");if("add"==r)if(this.savedParams.some((e=>e.group===t&&"filter"===e.type)))if(o){const i=this.savedParams.find((e=>e.group===t&&"filter"===e.type));this.savedParams=this.savedParams.filter((e=>e!==i));const a={type:e,group:t,target:l,collection:n,value:[s]};this.savedParams.push(a)}else{const e=this.savedParams.find((e=>e.group===t&&"filter"===e.type));e.value.forEach((s=>{document.querySelector(`[sb-filter-group=${JSON.stringify(t)}][sb-filter-value=${JSON.stringify(s)}]`).hasAttribute("sb-filter-excl")&&(e.value=e.value.filter((e=>e!==s)))})),e.value.push(s)}else{const i={type:e,group:t,target:l,collection:n,value:[s]};this.savedParams.push(i)}else{const e=this.savedParams.find((e=>e.group===t&&"filter"===e.type));if(e.value.length>1){const t=e.value.filter((e=>e!=s));e.value=t}else this.savedParams=this.savedParams.filter((t=>t!==e))}this.preStartQueryPromises()}updateFiltersUI(e,t,s){if("toggle"==e){const e=document.querySelector(`[sb-filter-group=${JSON.stringify(t)}][sb-filter-value=${JSON.stringify(s)}]`);e&&e.classList.add(this.filter.toggleActiveClass)}}updateSortUI(e,t,s,i){if("toggle"===this.sort.type){document.querySelectorAll('[sb-sort-type="toggle"]').forEach((e=>{e.classList.remove(this.sort.toggleActiveClass)}));document.querySelector(`[sb-sort-field=${JSON.stringify(t)}][sb-sort-dir='${i}'][sb-sort-group=${JSON.stringify(s)}]`).classList.add(this.sort.toggleActiveClass)}else if("select"===this.sort.type){const a=`${e},${t},${i},${s}`;document.querySelector('[sb-sort-type="select"]').value=a}}sortItems(e,t,s,i,a){const r=this.savedParams.find((t=>t.type===e));r.collection=t,r.target=s,r.value=i,r.group=a,this.preStartQueryPromises()}searchItems(e){this.enableSearch&&(clearTimeout(this.search.timer),this.search.timer=setTimeout((()=>{this.savedParams.find((e=>"search"===e.type)).value=e,this.preStartQueryPromises()}),this.search.delay))}updateSearchUI(e){document.querySelector('[sb-search="input"]').value=e}generatePagination=e=>{const t=document.querySelector('[sb-pag="classic"]');t.innerHTML="";const s=e.pages,i=e.page,a=this.pagination.maxButtons>s?s:this.pagination.maxButtons;let r=this.pageNumbers(s,a,i),o=document.querySelector('[sb-pag-btn="start"]').cloneNode(!0);o.style.removeProperty("display"),o.setAttribute("sb-pag-pages",s),1===r[0]&&o.classList.add(this.pagination.disabledClass),t.appendChild(o);let l=document.querySelector('[sb-pag-btn="prev"]').cloneNode(!0);l.style.removeProperty("display"),l.setAttribute("sb-pag-pages",s),1===i&&l.classList.add(this.pagination.disabledClass),t.appendChild(l);for(let e=0;e<r.length;e++){let a=document.querySelector('[sb-pag-btn="num"]').cloneNode(!0);a.setAttribute("sb-pag-btn",r[e]),a.setAttribute("sb-pag-pages",s);a.querySelector('[sb-pag-btn="text"]').textContent=r[e],i==r[e]&&a.classList.add(this.pagination.activeClass),a.style.removeProperty("display"),t.appendChild(a)}let n=document.querySelector('[sb-pag-btn="next"]').cloneNode(!0);n.style.removeProperty("display"),n.setAttribute("sb-pag-pages",s),i===s&&n.classList.add(this.pagination.disabledClass),t.appendChild(n);let c=document.querySelector('[sb-pag-btn="end"]').cloneNode(!0);c.style.removeProperty("display"),c.setAttribute("sb-pag-pages",s),r.slice(-1)[0]===s&&c.classList.add(this.pagination.disabledClass),t.appendChild(c)};generateLoadMore=e=>{const t=document.querySelector('[sb-pag="load-more"]');t.innerHTML="";const s=e.pages,i=e.page;let a=document.querySelector('[sb-pag-btn="load-more"]').cloneNode(!0);a.style.removeProperty("display"),a.setAttribute("sb-pag-pages",s),a.setAttribute("sb-pag-current",i),i===s?t.style.display="none":t.appendChild(a)};pageNumbers=(e,t,s)=>{const i=Math.floor(t/2);let a=t;s+i>=e?a=e:s>i&&(a=s+i);let r=a-t;return Array.from({length:t},((e,t)=>t+1+r))};paginationStart(e){this.updatePage(1)}paginationPrev(e){this.updatePage(parseInt(this.pagination.page)-1)}paginationPage(e){const t=e.target.getAttribute("sb-pag-btn");this.updatePage(parseInt(t))}paginationNext(e){this.updatePage(parseInt(this.pagination.page)+1)}paginationEnd(e){const t=e.target.getAttribute("sb-pag-pages");this.updatePage(parseInt(t))}updatePage(e){this.savedParams.find((e=>"pagination"===e.type&&"page"===e.group)).value=e,this.startQueryPromises(this.savedParams,!1)}getScrollPercent(){let e=document.documentElement,t=document.body,s="scrollTop",i="scrollHeight";return(e[s]||t[s])/((e[i]||t[i])-e.clientHeight)*100}addListeners(){if(this.enableFilter){const e=document.querySelectorAll('[sb-filter-type="toggle"]');if(e.forEach((t=>{if(t.addEventListener("click",(s=>{s.preventDefault();const i=t.getAttribute("sb-filter-group"),a=t.getAttribute("sb-filter-value"),r=t.getAttribute("sb-filter-field"),o=t.getAttribute("sb-filter-coll"),l=t.classList.contains(this.filter.toggleActiveClass)?"remove":"add";let n=!1;t.hasAttribute("sb-filter-excl")&&(n=!0),"remove"==l?t.classList.remove(this.filter.toggleActiveClass):(n?e.forEach((e=>{e.getAttribute("sb-filter-group")==i&&e.classList.remove(this.filter.toggleActiveClass)})):e.forEach((e=>{e.hasAttribute("sb-filter-excl")&&e.getAttribute("sb-filter-group")==i&&e.classList.remove(this.filter.toggleActiveClass)})),t.classList.add(this.filter.toggleActiveClass)),this.filterItems("filter",i,a,o,r,l,n)})),t.hasAttribute("sb-filter-cms")){const e=t.getAttribute("sb-filter-group"),s=t.querySelector("[sb-filter-cms-value]").innerText;t.setAttribute("sb-filter-value",s),this.filter.filters.length&&this.filter.filters.forEach((t=>{const i=t.group;i==e&&t.value.length&&t.value.forEach((e=>{e==s&&this.updateFiltersUI("toggle",i,e)}))}))}})),this.enableSort)if("toggle"===this.sort.type){const e=document.querySelectorAll('[sb-sort-type="toggle"]');e.forEach((t=>{t.addEventListener("click",(s=>{s.preventDefault(),e.forEach((e=>{e.classList.remove(this.sort.toggleActiveClass)}));const i=t.getAttribute("sb-sort-dir"),a=t.getAttribute("sb-sort-field"),r=t.getAttribute("sb-sort-coll"),o=t.getAttribute("sb-sort-group");"add"==(t.classList.contains(this.sort.toggleActiveClass)?"remove":"add")&&t.classList.add(this.sort.toggleActiveClass),this.sortItems("sort",r,a,i,o)}))}))}else if("select"===this.sort.type){document.querySelector('[sb-sort-type="select"]').addEventListener("change",(e=>{const t=e.target.value.split(",");this.sortItems("sort",t[0],t[1],t[2],t[3])}))}}if(this.enablePagination){if(!this.pagination.loadMore&&!this.pagination.infiniteScroll||this.pagination.loadMore&&!this.pagination.infiniteScroll){let e=null;this.pagination.loadMore||this.pagination.infiniteScroll||(e=document.querySelector('[sb-pag="classic"]')),this.pagination.loadMore&&!this.pagination.infiniteScroll&&(e=document.querySelector('[sb-pag="load-more"]')),e.addEventListener("click",(e=>{if(e.preventDefault(),e.target.getAttribute("sb-pag-btn")){const t=e.target.getAttribute("sb-pag-btn");this.pagination.loadMore||this.pagination.infiniteScroll||("start"==t?this.paginationStart(e):"prev"==t?this.paginationPrev(e):"next"==t?this.paginationNext(e):"end"==t?this.paginationEnd(e):this.paginationPage(e)),this.pagination.loadMore&&!this.pagination.infiniteScroll&&"load-more"==t&&this.paginationNext(e)}}))}this.pagination.infiniteScroll&&document.addEventListener("scroll",(e=>{this.getScrollPercent()>this.pagination.scrollPercentage&&0==this.private.lastPage&&0==this.private.scrollLoading&&(this.private.scrollLoading=!0,this.paginationNext())}))}if(this.enableSearch){const e=document.querySelector('[sb-search="input"]');e.addEventListener("keypress",(e=>{"13"==e.which&&e.preventDefault()})),e.addEventListener("input",(e=>{this.searchItems(e.target.value)}))}}}